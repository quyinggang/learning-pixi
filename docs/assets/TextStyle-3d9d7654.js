import{D as B,m as N,Q as v,a as A,d as E,v as M,N as $,y as V}from"./index-c08b86c0.js";const D=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function R(s){const t=typeof s.fontSize=="number"?`${s.fontSize}px`:s.fontSize;let e=s.fontFamily;Array.isArray(s.fontFamily)||(e=s.fontFamily.split(","));for(let r=e.length-1;r>=0;r--){let n=e[r].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!D.includes(n)&&(n=`"${n}"`),e[r]=n}return`${s.fontStyle} ${s.fontVariant} ${s.fontWeight} ${t} ${e.join(",")}`}const L={willReadFrequently:!0},f=class i{static get experimentalLetterSpacingSupported(){let t=i._experimentalLetterSpacingSupported;if(t!==void 0){const e=B.get().getCanvasRenderingContext2D().prototype;t=i._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,r,n,a,o,l,u,m){this.text=t,this.style=e,this.width=r,this.height=n,this.lines=a,this.lineWidths=o,this.lineHeight=l,this.maxLineWidth=u,this.fontProperties=m}static measureText(t=" ",e,r=i._canvas,n=e.wordWrap){var k;const a=`${t}:${e.styleKey}`;if(i._measurementCache[a])return i._measurementCache[a];const o=R(e),l=i.measureFont(o);l.fontSize===0&&(l.fontSize=e.fontSize,l.ascent=e.fontSize);const u=i.__context;u.font=o;const g=(n?i._wordWrap(t,e,r):t).split(/(?:\r\n|\r|\n)/),w=new Array(g.length);let W=0;for(let h=0;h<g.length;h++){const c=i._measureText(g[h],e.letterSpacing,u);w[h]=c,W=Math.max(W,c)}const p=((k=e._stroke)==null?void 0:k.width)||0;let x=W+p;e.dropShadow&&(x+=e.dropShadow.distance);const S=e.lineHeight||l.fontSize+p;let _=Math.max(S,l.fontSize+p*2)+(g.length-1)*(S+e.leading);return e.dropShadow&&(_+=e.dropShadow.distance),new i(t,e,x,_,g,w,S+e.leading,W,l)}static _measureText(t,e,r){let n=!1;i.experimentalLetterSpacingSupported&&(i.experimentalLetterSpacing?(r.letterSpacing=`${e}px`,r.textLetterSpacing=`${e}px`,n=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let a=r.measureText(t).width;return a>0&&(n?a-=e:a+=(i.graphemeSegmenter(t).length-1)*e),a}static _wordWrap(t,e,r=i._canvas){const n=r.getContext("2d",L);let a=0,o="",l="";const u=Object.create(null),{letterSpacing:m,whiteSpace:g}=e,w=i._collapseSpaces(g),W=i._collapseNewlines(g);let p=!w;const x=e.wordWrapWidth+m,S=i._tokenize(t);for(let _=0;_<S.length;_++){let d=S[_];if(i._isNewline(d)){if(!W){l+=i._addLine(o),p=!w,o="",a=0;continue}d=" "}if(w){const h=i.isBreakingSpace(d),c=i.isBreakingSpace(o[o.length-1]);if(h&&c)continue}const k=i._getFromCache(d,m,u,n);if(k>x)if(o!==""&&(l+=i._addLine(o),o="",a=0),i.canBreakWords(d,e.breakWords)){const h=i.wordWrapSplit(d);for(let c=0;c<h.length;c++){let T=h[c],z=T,F=1;for(;h[c+F];){const C=h[c+F];if(!i.canBreakChars(z,C,d,c,e.breakWords))T+=C;else break;z=C,F++}c+=F-1;const I=i._getFromCache(T,m,u,n);I+a>x&&(l+=i._addLine(o),p=!1,o="",a=0),o+=T,a+=I}}else{o.length>0&&(l+=i._addLine(o),o="",a=0);const h=_===S.length-1;l+=i._addLine(d,!h),p=!1,o="",a=0}else k+a>x&&(p=!1,l+=i._addLine(o),o="",a=0),(o.length>0||!i.isBreakingSpace(d)||p)&&(o+=d,a+=k)}return l+=i._addLine(o,!1),l}static _addLine(t,e=!0){return t=i._trimRight(t),t=e?`${t}
`:t,t}static _getFromCache(t,e,r,n){let a=r[t];return typeof a!="number"&&(a=i._measureText(t,e,n)+e,r[t]=a),a}static _collapseSpaces(t){return t==="normal"||t==="pre-line"}static _collapseNewlines(t){return t==="normal"}static _trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const r=t[e];if(!i.isBreakingSpace(r))break;t=t.slice(0,-1)}return t}static _isNewline(t){return typeof t!="string"?!1:i._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:i._breakingSpaces.includes(t.charCodeAt(0))}static _tokenize(t){const e=[];let r="";if(typeof t!="string")return e;for(let n=0;n<t.length;n++){const a=t[n],o=t[n+1];if(i.isBreakingSpace(a,o)||i._isNewline(a)){r!==""&&(e.push(r),r=""),e.push(a);continue}r+=a}return r!==""&&e.push(r),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,n,a){return!0}static wordWrapSplit(t){return i.graphemeSegmenter(t)}static measureFont(t){if(i._fonts[t])return i._fonts[t];const e=i._context;e.font=t;const r=e.measureText(i.METRICS_STRING+i.BASELINE_SYMBOL),n={ascent:r.actualBoundingBoxAscent,descent:r.actualBoundingBoxDescent,fontSize:r.actualBoundingBoxAscent+r.actualBoundingBoxDescent};return i._fonts[t]=n,n}static clearMetrics(t=""){t?delete i._fonts[t]:i._fonts={}}static get _canvas(){if(!i.__canvas){let t;try{const e=new OffscreenCanvas(0,0),r=e.getContext("2d",L);if(r!=null&&r.measureText)return i.__canvas=e,e;t=B.get().createCanvas()}catch{t=B.get().createCanvas()}t.width=t.height=10,i.__canvas=t}return i.__canvas}static get _context(){return i.__context||(i.__context=i._canvas.getContext("2d",L)),i.__context}};f.METRICS_STRING="|ÉqÅ";f.BASELINE_SYMBOL="M";f.BASELINE_MULTIPLIER=1.4;f.HEIGHT_MULTIPLIER=2;f.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const s=new Intl.Segmenter;return t=>[...s.segment(t)].map(e=>e.segment)}return s=>[...s]})();f.experimentalLetterSpacing=!1;f._fonts={};f._newlines=[10,13];f._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];f._measurementCache={};let U=f;const K=["_fontFamily","_fontStyle","_fontSize","_fontVariant","_fontWeight","_breakWords","_align","_leading","_letterSpacing","_lineHeight","_textBaseline","_whiteSpace","_wordWrap","_wordWrapWidth","_padding","_cssOverrides","_trim"];function G(s){const t=[];let e=0;for(let r=0;r<K.length;r++){const n=K[r];t[e++]=s[n]}return e=H(s._fill,t,e),e=j(s._stroke,t,e),t.join("-")}function H(s,t,e){var r;return s&&(t[e++]=s.color,t[e++]=s.alpha,t[e++]=(r=s.fill)==null?void 0:r.uid),e}function j(s,t,e){return s&&(e=H(s,t,e),t[e++]=s.width,t[e++]=s.alignment,t[e++]=s.cap,t[e++]=s.join,t[e++]=s.miterLimit),e}const b=class y extends N{constructor(t={}){super(),P(t);const e={...y.defaultTextStyle,...t};for(const r in e){const n=r;this[n]=e[r]}this.update()}get align(){return this._align}set align(t){this._align=t,this.update()}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords=t,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(t){t!==null&&typeof t=="object"?this._dropShadow={...y.defaultDropShadow,...t}:this._dropShadow=t?{...y.defaultDropShadow}:null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this.update()}get fontSize(){return this._fontSize}set fontSize(t){typeof t=="string"?this._fontSize=parseInt(t,10):this._fontSize=t,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t,this.update()}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this.update()}get leading(){return this._leading}set leading(t){this._leading=t,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing=t,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.update()}get padding(){return this._padding}set padding(t){this._padding=t,this.update()}get trim(){return this._trim}set trim(t){this._trim=t,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace=t,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap=t,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth=t,this.update()}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._fill=v(t===0?"black":t,A.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._stroke=v(t,A.defaultStrokeStyle),this.update())}_generateKey(){return this._styleKey=G(this),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}reset(){const t=y.defaultTextStyle;for(const e in t)this[e]=t[e]}get styleKey(){return this._styleKey||this._generateKey()}clone(){return new y({align:this.align,breakWords:this.breakWords,dropShadow:this.dropShadow,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth})}destroy(t=!1){var r,n,a,o;if(this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const l=typeof t=="boolean"?t:t==null?void 0:t.textureSource;(r=this._fill)!=null&&r.texture&&this._fill.texture.destroy(l),(n=this._originalFill)!=null&&n.texture&&this._originalFill.texture.destroy(l),(a=this._stroke)!=null&&a.texture&&this._stroke.texture.destroy(l),(o=this._originalStroke)!=null&&o.texture&&this._originalStroke.texture.destroy(l)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}};b.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};b.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let O=b;function P(s){const t=s;if(typeof t.dropShadow=="boolean"&&t.dropShadow){const e=O.defaultDropShadow;s.dropShadow={alpha:t.dropShadowAlpha??e.alpha,angle:t.dropShadowAngle??e.angle,blur:t.dropShadowBlur??e.blur,color:t.dropShadowColor??e.color,distance:t.dropShadowDistance??e.distance}}if(t.strokeThickness){E(M,"strokeThickness is now a part of stroke");const e=t.stroke;s.stroke={color:e,width:t.strokeThickness}}if(Array.isArray(t.fill)){E(M,"gradient fill is now a fill pattern: `new FillGradient(...)`");const e=new $(0,0,0,s.fontSize*1.7),r=t.fill.map(n=>V.shared.setValue(n).toNumber());r.forEach((n,a)=>{const o=t.fillGradientStops[a]??a/r.length;e.addColorStop(o,n)}),s.fill={fill:e}}}export{U as C,O as T,R as f,G as g};
